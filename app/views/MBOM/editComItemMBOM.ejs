<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <title><%= title %></title>
    <meta content="Quote Detail" name="SAI-APS-Portal" />
    <link rel="shortcut icon" href="/public/assets/images/SAI-Logo.JPG">
    <link rel="stylesheet" href="/public/plugins/morris/morris.css">

    <link href="/public/plugins/RWD-Table-Patterns/dist/css/rwd-table.min.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="/public/plugins/bootstrap-colorpicker/css/bootstrap-colorpicker.min.css" rel="stylesheet" />
    <link href="/public/plugins/bootstrap-datepicker/dist/css/bootstrap-datepicker.min.css" rel="stylesheet" />
    <link href="/public/plugins/select2/css/select2.min.css" rel="stylesheet" type="text/css" />
    <link href="/public/plugins/bootstrap-touchspin/css/jquery.bootstrap-touchspin.min.css" rel="stylesheet" />

    <link href="/public/assets/css/breakerDragDrop.css" rel="stylesheet" type="text/css" />
    <link href="/public/plugins/jquery-ui/jquery-ui.min.css" rel="stylesheet" type="text/css" />
    <!-- ION Slider -->
    <link href="/public/plugins/ion-rangeslider/ion.rangeSlider.css" rel="stylesheet" type="text/css"/>
    <link href="/public/plugins/ion-rangeslider/ion.rangeSlider.skinModern.css" rel="stylesheet" type="text/css"/>

    <link href="/public/assets/css/metismenu.min.css" rel="stylesheet" type="text/css">
    <link href="/public/assets/css/icons.css" rel="stylesheet" type="text/css">
    <link href="/public/assets/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="/public/assets/css/style.css" rel="stylesheet" type="text/css">
</head>

<body>
<div id="wrapper">
    <!-- Top Bar Start -->
    <%- include('../partials/header') %>
    <!-- Top Bar End -->

    <!-- ========== Left Sidebar Start ========== -->
    <%- include('../partials/sidebar') %>
    <!-- Left Sidebar End -->

    <div class="content-page">
        <!-- Content Start -->
        <div class="content">
            <div class="container-fluid">
                            <div class="row">
                                <div class="col-sm-12">
                                    <div class="card m-b-20">
                                        <div class="card-body">
                                            <h4 class="mt-0 header-title">Item Summary</h4>
                                            <p class="mb-0">
                                                Fill out the following for each layout, and click "Save" afterwards
                                            </p>
                                            <p class="text-muted m-b-30"></p>
                                            <form id="editComItemTableForm" class="editComItemTableForm" action="/editComItemTablePOST/?comItemID=<%=editComItemData.comItemID%>" method="POST">
                                                <div class="form-group">
                                                    <div class="row">
                                                        <div class="col-sm-3">
                                                            <label for="example-text-input" class="col-form-label">Item Type</label>
                                                            <select class="form-control select2" id="itemSelect2" name="itemSelect2" required>
                                                                <option value="">Select</option>
                                                                <% 
                                                                    // collect, dedupe and sort item types
                                                                    let userItemTypes = new Set();
                                                                    for(let el of (comItemData||[])){
                                                                        if(el && el.itemType) userItemTypes.add(String(el.itemType).trim());
                                                                    }
                                                                    const sortedTypes = Array.from(userItemTypes).filter(Boolean).sort(function(a,b){ return a.localeCompare(b,'en',{sensitivity:'base'}); });
                                                                %>
                                                                <% for(const el of sortedTypes){ %>
                                                                    <% if(el == editComItemData.itemType){ %>
                                                                        <option value="<%= el%>" selected><%=el%></option>
                                                                        <% var notOther = true; %>
                                                                    <% } else { %>
                                                                        <option value="<%= el%>"><%=el%></option>
                                                                    <% } %>
                                                                <% } %>
                                                                <% if(!notOther){ %>
                                                                    <option selected>OTHER</option>
                                                                <% } else { %>
                                                                    <option>OTHER</option>
                                                                <% } %>
                                                            </select>
                                                            <input type="text" name="otherItemType" class="form-control" id="otherItemType" value="<%=editComItemData.itemType%>" placeholder="Item Type Here" style="display:none;" autocomplete="off"/>
                                                        </div>
                                                        <div class="col-sm-3">
                                                            <label for="example-text-input" class="col-form-label">Item Mfg.</label>
                                                            <% // Single dropdown for manufacturer: values keep the itemType|itemMfg format for server compatibility %>
                                                            <select class="form-control select2" id="mfgSelect2" name="mfgSelect2">
                                                                <option value="">Select</option>
                                                                    <% 
                                                                        // collect and dedupe manufacturers by name; pick first itemType as representative
                                                                        let userMfgUnique = new Map();
                                                                        for (let el of (comItemData||[])){
                                                                            if(el && el.itemType){
                                                                                const itemType = String(el.itemType||'').trim();
                                                                                const mfg = String(el.itemMfg||'').trim();
                                                                                if(!mfg) continue;
                                                                                const key = mfg.toUpperCase();
                                                                                if(!userMfgUnique.has(key)){
                                                                                    userMfgUnique.set(key, { value: itemType + '|' + mfg, itemType: itemType, mfg: mfg });
                                                                                }
                                                                            }
                                                                        }
                                                                        const userItemMfg = Array.from(userMfgUnique.values()).sort(function(a,b){ return a.mfg.localeCompare(b.mfg,'en',{sensitivity:'base'}); });
                                                                    %>
                                                                    <% for (const rec of userItemMfg) { %>
                                                                        <% if (rec.mfg == editComItemData.itemMfg) { %>
                                                                            <option data-parent="<%= rec.itemType %>" value="<%= rec.value %>" selected><%= rec.mfg %></option>
                                                                        <% } else { %>
                                                                            <option data-parent="<%= rec.itemType %>" value="<%= rec.value %>"><%= rec.mfg %></option>
                                                                        <% } %>
                                                                    <% } %>
                                                                <option value="OTHER">OTHER</option>
                                                            </select>
                                                            <input type="text" name="otherMfgType" class="form-control" id="otherMfgType" value="<%= editComItemData.itemMfg %>" placeholder="Type Mfg. Here" style="display:none;" autocomplete="off"/>
                                                        </div>
                                                        <div class="col-sm-6">
                                                            <label for="example-text-input" class="col-form-label">Description</label>
                                                            <input type="text" name="itemDesc" class="form-control" maxlength="160" value="<%=editComItemData.itemDesc%>" placeholder="Type Description Here" autocomplete="off"/>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-sm-6">
                                                            <label for="example-text-input" class="col-form-label">P/N</label>
                                                            <input type="text" name="itemPN" class="form-control" value="<%=editComItemData.itemPN%>" placeholder="Type P/N Here" autocomplete="off"/>
                                                        </div>
                                                        <div class="col-sm-2">
                                                            <label for="example-text-input" class="col-form-label">Unit Of Issue</label>
                                                            <select class="form-control select2" name="unitOfIssue">
                                                                <option value="Select">Select</option>
                                                                <% if (editComItemData.unitOfIssue == 'EA') { %>
                                                                    <option value="EA" selected="selected">EA</option>
                                                                <% } else { %>
                                                                    <option value="EA">EA</option>
                                                                <% } %>
                                                                <% if (editComItemData.unitOfIssue == 'FT') { %>
                                                                    <option value="FT" selected="selected">FT</option>
                                                                <% } else { %>
                                                                    <option value="FT">FT</option>
                                                                <% } %>
                                                                <% if (editComItemData.unitOfIssue == 'LBS') { %>
                                                                    <option value="LBS" selected="selected">LBS</option>
                                                                <% } else { %>
                                                                    <option value="LBS">LBS</option>
                                                                <% } %>
                                                            </select>
                                                        </div>
                                                        <div class="col-sm-2">
                                                            <label for="example-text-input" class="col-form-label">Cat. Code</label>
                                                            <select class="form-control select2" name="catCode">
                                                                <option value="Select">Select</option>
                                                                <% 
                                                                    // dedupe and sort cat codes
                                                                    const catSet = new Set();
                                                                    for (let i = 0; i < (catCodeData||[]).length; i++){
                                                                        const val = (catCodeData[i] && catCodeData[i].catCode) ? String(catCodeData[i].catCode).trim() : String(catCodeData[i] || '').trim();
                                                                        if(val) catSet.add(val);
                                                                    }
                                                                    const catArr = Array.from(catSet).sort(function(a,b){ return a.localeCompare(b,'en',{sensitivity:'base'}); });
                                                                %>
                                                                <% for (const code of catArr){ %>
                                                                    <% if(code == editComItemData.catCode){ %>
                                                                        <option value="<%= code %>" selected><%= code %></option>
                                                                    <% } else { %>
                                                                        <option value="<%= code %>"><%= code %></option>
                                                                    <% } %>
                                                                <% } %>
                                                            </select>
                                                        </div>
                                                        <div class="col-sm-2">
                                                            <label for="example-text-input" class="col-form-label">Class</label>
                                                            <select class="form-control select2" name="class">
                                                                <option value="Select">Select</option>
                                                                <% 
                                                                    const classSet = new Set();
                                                                    for (let i = 0; i < (classCodeData||[]).length; i++){
                                                                        const val = (classCodeData[i] && classCodeData[i].classCode) ? String(classCodeData[i].classCode).trim() : String(classCodeData[i] || '').trim();
                                                                        if(val) classSet.add(val);
                                                                    }
                                                                    const classArr = Array.from(classSet).sort(function(a,b){ return a.localeCompare(b,'en',{sensitivity:'base'}); });
                                                                %>
                                                                <% for (const cl of classArr){ %>
                                                                    <% if(cl == editComItemData.classCode){ %>
                                                                        <option value="<%= cl %>" selected><%= cl %></option>
                                                                    <% } else { %>
                                                                        <option value="<%= cl %>"><%= cl %></option>
                                                                    <% } %>
                                                                <% } %>
                                                            </select>
                                                        </div>
                                                        <div class="col-sm-2">
                                                            <label for="statusSelect" class="col-form-label">Status</label>
                                                            <select class="form-control select2" id="statusSelect" name="status">
                                                                <% const curStatus = (editComItemData && editComItemData.status) ? String(editComItemData.status).toUpperCase() : 'COMMON'; %>
                                                                <option value="Common" <%= curStatus === 'COMMON' ? 'selected' : '' %>>Common</option>
                                                                <option value="Uncommon" <%= curStatus === 'UNCOMMON' ? 'selected' : '' %>>Uncommon</option>
                                                                <option value="OBSOLETE" <%= curStatus === 'OBSOLETE' ? 'selected' : '' %>>OBSOLETE</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="row justify-content-center">
                                                        <div class="col-2" style="padding-top:5%;">
                                                            <input id="uploadBtn" type="submit" value="Save" class="btn btn-block btn-lg btn-success waves-effect waves-light" />
                                                        </div>
                                                        <div class="col-2" style="padding-top:5%;">
                                                            <a id="cancelBtn" href="../MBOM" class="btn btn-block btn-lg btn-secondary waves-effect waves-light">Cancel</a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div> <!-- container-fluid -->
        </div> <!-- content -->
    </div> <!-- content-page -->
    <%- include('../partials/footer') %>
</div> <!-- wrapper -->


<!-- Responsive-table-->
<script src="/public/plugins/RWD-Table-Patterns/dist/js/rwd-table.min.js"></script>
<script>
    $(function() {
        $('.table-responsive').responsiveTable({
            addDisplayAllBtn: 'btn btn-secondary'
        });
    });
</script>

<%- include('../partials/scripts') %>

<script>
    $(function() {
        $('.table-responsive').responsiveTable({
            addDisplayAllBtn: 'btn btn-secondary'
        });
    });
</script>

<!-- User developed scripts -->
<script>
    (function($){
        function setItemTypeState(){
            var v = $('#itemSelect2').val();
            if (v === 'OTHER') {
                $('#otherItemType').show().prop('disabled', false);
            } else {
                $('#otherItemType').hide().prop('disabled', true);
            }
        }
        function setMfgState(){
            var v = $('#mfgSelect2').val() || '';
            // If value is exactly 'OTHER' or ends with '|OTHER'
            if (v === 'OTHER' || v.toUpperCase().endsWith('|OTHER')) {
                $('#otherMfgType').show().prop('disabled', false);
            } else {
                $('#otherMfgType').hide().prop('disabled', true);
            }
        }
        $(function(){
            setItemTypeState();
            setMfgState();
            $('#itemSelect2').on('change', setItemTypeState);
            $('#mfgSelect2').on('change', setMfgState);

            // Warn on OBSOLETE
            $('#editComItemTableForm').on('submit', function(e){
                var status = ($('#statusSelect').val() || '').toUpperCase();
                if (status === 'OBSOLETE'){
                    var ok = window.confirm('This item will be marked OBSOLETE and will be hidden from normal selection lists. Continue?');
                    if (!ok) {
                        e.preventDefault();
                        return false;
                    }
                }
                return true;
            });
        });
    })(jQuery);
</script>
<script src="/public/assets/js/mbomFilterDropdown.js"></script>

</body>
</html>