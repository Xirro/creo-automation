<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Request Account - Creo Automation</title>
  <link rel="stylesheet" href="/public/assets/css/bootstrap.min.css">
  <style>
    body { padding-top: 40px; }
    .box { max-width: 600px; margin: 0 auto; }
  </style>
</head>
<body>
  <div class="container box">
  <h3>Request an Account</h3>
  <p><small class="text-danger">* required</small></p>
    <% if (error) { %>
      <div class="alert alert-danger" role="alert" aria-live="polite"><%= error %></div>
    <% } %>
    <form method="post" action="/request-account">
      <div class="form-group">
        <label>Email <span class="text-danger" aria-hidden="true">*</span></label>
        <input class="form-control" name="email" placeholder="Email" value="<%= email %>" type="email" required />
      </div>
      <div class="form-group">
        <label>Username <span class="text-danger" aria-hidden="true">*</span></label>
        <input class="form-control" name="username" placeholder="Username" value="<%= typeof username !== 'undefined' ? username : '' %>" required />
      </div>
      <div class="form-group">
        <label>Password <span class="text-danger" aria-hidden="true">*</span></label>
        <input id="passwordInput" class="form-control" name="password" type="password" minlength="6" required />
      </div>
      <div class="form-group">
        <label>Confirm Password <span class="text-danger" aria-hidden="true">*</span></label>
        <input id="confirmInput" class="form-control" name="confirm" type="password" minlength="6" required />
        <small id="pwMismatch" class="text-danger" style="display:none;">Passwords do not match.</small>
      </div>
      <button class="btn btn-primary" type="submit">Submit Request</button>
      <a href="/login" class="btn btn-secondary ml-2">Back to Login</a>
    </form>
    <p class="mt-3 text-muted small">Requests are sent to IT for manual account creation. You will be notified by IT when the DB account is created.</p>
  </div>

  <script>
    (function() {
      var form = document.querySelector('form[action="/request-account"]');
      var pw = document.getElementById('passwordInput');
      var confirm = document.getElementById('confirmInput');
      var mismatch = document.getElementById('pwMismatch');
      if (!form || !pw || !confirm) return;

      function checkMatch() {
        if (confirm.value.length === 0) { mismatch.style.display = 'none'; return true; }
        if (pw.value !== confirm.value) { mismatch.style.display = 'inline'; return false; }
        mismatch.style.display = 'none';
        return true;
      }

      pw.addEventListener('input', checkMatch);
      confirm.addEventListener('input', checkMatch);

      form.addEventListener('submit', function(e) {
        if (!checkMatch()) { e.preventDefault(); confirm.focus(); }
      });
    })();
  </script>
</body>
</html>