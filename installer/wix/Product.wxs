<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  <!--
    Product.wxs - WiX installer template for Creo Automation
    Build-time vars required:
      -dProductVersion=...    (Product Version)
      -dSourceDir=...        (path to app files)
      -dMainExeId=...        (Id of the main exe file inside harvested .wxs)
  -->
  <Product Id="*"
           Name="Creo Automation"
           Language="1033"
           Version="$(var.ProductVersion)"
           Manufacturer="Xirro"
           UpgradeCode="D4A5B3E8-6C2F-4F1A-9B7D-0A1C2E3F4B5C">

    <Package InstallerVersion="500" Compressed="yes" InstallScope="perMachine"/>
    <MajorUpgrade AllowDowngrades="no" AllowSameVersionUpgrades="yes" DowngradeErrorMessage="A newer version of [ProductName] is already installed."/>
    <MediaTemplate/>

    <!-- Directory structure -->
    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ProgramFilesFolder">
        <Directory Id="INSTALLFOLDER" Name="Creo Automation"/>
      </Directory>

      <!-- Start Menu shortcut folder -->
      <Directory Id="ProgramMenuFolder">
        <Directory Id="ApplicationProgramsFolder" Name="Creo Automation"/>
      </Directory>
    </Directory>

    <!-- Icon (SourceDir provided at build time) -->
    <Icon Id="AppIcon" SourceFile="$(var.SourceDir)\creo-automation.ico" />

    <!-- Features and harvested components -->
    <Feature Id="ProductFeature" Title="Creo Automation" Level="1">
      <ComponentGroupRef Id="AppComponents" />
      <ComponentRef Id="AppShortcutComponent" />
    </Feature>

    <!-- Shortcut & uninstall cleanup component -->
    <DirectoryRef Id="INSTALLFOLDER">
      <Component Id="AppShortcutComponent" Guid="*">
        <File Id="$(var.MainExeId)" KeyPath="yes" Source="$(var.SourceDir)\CreoAutomation.exe">
          <Shortcut Id="StartMenuShortcut"
                    Directory="ApplicationProgramsFolder"
                    Name="Creo Automation"
                    Description="Launch Creo Automation"
                    WorkingDirectory="INSTALLFOLDER"
                    Icon="AppIcon" />
        </File>

        <RemoveFolder Id="RemoveApplicationProgramsFolder" Directory="ApplicationProgramsFolder" On="uninstall"/>
        <RegistryValue Root="HKLM" Key="Software\Xirro\CreoAutomation" Name="Installed" Type="integer" Value="1" />
      </Component>
    </DirectoryRef>

  </Product>
</Wix>